<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Le mie ricette preferite ‚Äî Ricettario</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .fav-wrap{max-width:760px;margin:2rem auto;background:#fff3e6;padding:1.25rem;border-radius:1rem;box-shadow:0 0 10px rgba(0,0,0,.08)}
    .topbar{display:flex;gap:.75rem;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap}
    .badge{background:#e57f3a;color:#fff;border-radius:999px;padding:.2rem .55rem;font-size:.85rem}
    .actions-top{display:flex;gap:.5rem;align-items:center}
    .btn{border:none;border-radius:8px;padding:.45rem .7rem;cursor:pointer}
    .btn-clear{background:#ffd0c0}
    .fav-card{background:#fff;border:1px dashed #e57f3a;border-radius:1rem;padding:1rem;margin-bottom:1rem}
    .fav-title{margin:0 0 .5rem;color:#e57f3a}
    .fav-actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.75rem}
    .btn-copy{background:#f0c28b}
    .btn-del{background:#ffd0c0}
    .empty{opacity:.7;text-align:center;padding:1rem}
    a { color: inherit; }
  </style>
</head>
<body>
  <div class="fav-wrap">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:.5rem">
        <h1 style="margin:0">‚≠ê Le mie ricette</h1>
        <span id="cap-badge" class="badge">0/5</span>
      </div>
      <div class="actions-top">
        <a href="./" style="text-decoration:none">‚Ü©Ô∏é Torna al Ricettario</a>
        <button id="clear-all" class="btn btn-clear" title="Rimuovi tutte le ricette salvate">üóëÔ∏è Svuota tutti</button>
      </div>
    </div>

    <div id="fav-list"></div>
  </div>

  <script>
    const KEY = 'ricettario:favorites';
    const CAP = 5;

    function loadFavs(){
      try { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
      catch { return []; }
    }
    function saveFavs(list){
      // Mantieni il cap anche qui per robustezza
      if(list.length > CAP) list = list.slice(0, CAP);
      localStorage.setItem(KEY, JSON.stringify(list));
    }

    function setBadge(n){
      const el = document.getElementById('cap-badge');
      el.textContent = `${n}/${CAP}`;
      el.style.background = n >= CAP ? '#d9534f' : '#e57f3a'; // rosso se pieno
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function render(){
      const root = document.getElementById('fav-list');
      const favs = loadFavs();
      setBadge(favs.length);

      if(!favs.length){
        root.innerHTML = '<p class="empty">Non hai ancora salvato nessuna ricetta. Torna al Ricettario e usa la stellina ‚≠ê per salvarle.</p>';
        return;
      }

      root.innerHTML = '';
      favs.forEach((f, idx) => {
        const card = document.createElement('div');
        card.className = 'fav-card';
        card.innerHTML = `
          <h3 class="fav-title">${escapeHtml(f.title || 'Ricetta')}</h3>
          <div class="fav-body" style="white-space:pre-wrap">${escapeHtml(f.body || '')}</div>
          ${f.shopping ? `<h4 style="margin:.75rem 0 .25rem">üßæ Ingredienti e dosi</h4>
            <div class="fav-shopping" style="white-space:pre-wrap">${escapeHtml(f.shopping)}</div>` : ''}
          <div class="fav-actions">
            <button class="btn btn-copy" data-idx="${idx}">üìã Copia</button>
            <button class="btn btn-del" data-idx="${idx}">üóëÔ∏è Elimina</button>
          </div>
        `;
        root.appendChild(card);
      });

      // listeners
      root.querySelectorAll('.btn-copy').forEach(b=>{
        b.addEventListener('click', e=>{
          const i = Number(e.currentTarget.dataset.idx);
          const f = loadFavs()[i];
          const text = `${f.title}\n\n${f.body}${f.shopping?`\n\nIngredienti e dosi:\n${f.shopping}`:''}`;
          navigator.clipboard.writeText(text);
          alert('Copiato negli appunti!');
        });
      });
      root.querySelectorAll('.btn-del').forEach(b=>{
        b.addEventListener('click', e=>{
          const i = Number(e.currentTarget.dataset.idx);
          const favs = loadFavs();
          favs.splice(i,1);
          saveFavs(favs);
          render();
        });
      });
    }

    document.getElementById('clear-all').addEventListener('click', () => {
      if (!confirm('Vuoi davvero rimuovere tutte le ricette salvate?')) return;
      saveFavs([]);
      render();
    });

    render();
  </script>
</body>
</html>